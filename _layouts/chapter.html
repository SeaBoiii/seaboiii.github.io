<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.Title | default: page.title }} · {{ site.title }}</title>
    <link rel="stylesheet" href="{{ "/assets/css/reader.css" | relative_url }}">
  </head>
  <body>
    <header class="site-header">
      <a class="brand" href="{{ "/" | relative_url }}">{{ site.title }}</a>
      <nav class="crumbs">
        <a href="{{ "/novel/" | relative_url }}">All Novels</a>
        <span>/</span>
        <a href="{{ "/novel/" | append: page.novel | append: "/" | relative_url }}">
          {{ page.novel | replace: '-', ' ' | capitalize }}
        </a>
      </nav>
    </header>

    <main class="reader">
      <article>
        <h1>{{ page.Title | default: page.title }}</h1>
        {% if page.order %}<div class="chapter-meta">Chapter {{ page.order }}</div>{% endif %}
        {{ content }}
      </article>

{% comment %}Build list of chapters for this novel{% endcomment %}
{% assign pathprefix = '/novel/' | append: page.novel | append: '/' %}
{% assign siblings = site.pages
  | where_exp: 'p', 'p.url contains pathprefix'
  | where_exp: 'p', 'p.name != "index.md"'
  | sort: 'order' %}

{% comment %}Find index of current page within siblings{% endcomment %}
{% assign idx = -1 %}
{% for c in siblings %}
  {% if c.url == page.url %}
    {% assign idx = forloop.index0 %}
  {% endif %}
{% endfor %}
{% assign count = siblings | size %}



        <nav class="pager">
            {% comment %}Prev (only if current is found and not first){% endcomment %}
            {% if idx > 0 %}
                <a class="btn prev" rel="prev" href="{{ siblings[idx | minus: 1].url | relative_url }}">← Prev</a>
            {% else %}
                <span></span>
            {% endif %}

            {% comment %}Chapters (TOC){% endcomment %}
            {% assign toc = site.pages | where_exp: 'p', 'p.url == pathprefix' | first %}
            {% assign toc_url = toc.url | default: pathprefix | append: 'index.html' %}
            {% if page.url == toc_url %}
                <span class="btn toc" aria-current="page">Chapters</span>
            {% else %}
                <a class="btn toc" href="{{ toc_url | relative_url }}">Chapters</a>
            {% endif %}

            {% comment %}Next (only if current is found and not last){% endcomment %}
            {% if idx != -1 and idx < count | minus: 1 %}
                <a class="btn next" rel="next" href="{{ siblings[idx | plus: 1].url | relative_url }}">Next →</a>
            {% else %}
                <span></span>
            {% endif %}
        </nav>
    </main>

    <script src="{{ "/assets/js/chapter.js" | relative_url }}" defer></script>
  </body>
</html>
